<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to Create a Streamlit Custom Component?</title>

    <meta property="og:image" content="/og-images/58a355a2.png" />

    <meta
    name="title" content="How to Create a Streamlit Custom Component?">
    <meta
    name="description" content="A guide to creating a Streamlit custom component with Web Components">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Jay&#39;s Notes">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Jay&#39;s Notes">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/github-markdown-light.css">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F2175QDTKC"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'G-F2175QDTKC');
    </script>
    

    <style>
      /*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
* { box-sizing: border-box; }
    </style>
  </head>
  <body>
    <a href="#skip" class="visually-hidden">Skip to main content</a>

    <header>
      <div class="header-content">
        <a href="/" class="home-link">Jay&#39;s Notes</a>
        <nav>
          <h2 class="visually-hidden">Top level navigation menu</h2>
          <ul class="nav">
            

            <li class="nav-item">
              <a href="https://zijie.wang">About</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main id="skip">
      
<link rel="stylesheet" href="/css/post.css">
<link rel="stylesheet" href="/css/prism-theme-github-light.css">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F2175QDTKC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'G-F2175QDTKC');
</script>



<div class="markdown-body">

  <div class="top-bar">

    <div class="post-metadata">

      <svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
        <path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"/>
      </svg>

      <a href="https://github.com/xiaohk/notes/tree/main/content/note/streamlit-custom-component.md" class="filename">streamlit-custom-component.md</a>

      <div>
        <time datetime="2025-03-02">02 March 2025</time>
      </div>
        <div class="tag-wrapper">
          <a href="/tags/web-component/" class="post-tag">web component</a>

        </div>
        <div class="tag-wrapper">
          <a href="/tags/web-development/" class="post-tag">web development</a>

        </div>
        <div class="tag-wrapper">
          <a href="/tags/streamlit/" class="post-tag">streamlit</a>

        </div>
    </div>
  </div>

  <div class="content">
    <h1 id="how-to-create-streamlit-custom-component" tabindex="-1">How to Create Streamlit Custom Component? <a class="header-anchor" href="#how-to-create-streamlit-custom-component">#</a></h1>
<p>Streamlit's support for custom components is limited, and creating one using standard web technologies can be complex. The trickiest aspect is managing the event handling within Streamlit. However, here is a practical solution for developing a <strong>Streamlit custom component</strong> with <strong>Web Components</strong> that allows for <strong>two-way communication</strong> with the Streamlit app. You can find all the code for this working example on GitHub.</p>
<h1 id="1-compile-web-component" tabindex="-1">1. Compile Web Component <a class="header-anchor" href="#1-compile-web-component">#</a></h1>
<h2 id="1-1-component-overview" tabindex="-1">1.1. Component Overview <a class="header-anchor" href="#1-1-component-overview">#</a></h2>
<p>In this tutorial, we will walk through an example using Lit Element Web Component. The code of the component quest-board is in the directory <code>quest-board</code>.</p>
<p>The component is simple. It takes a string array <code>quests</code> as an attribute / property. It renders the quests. Each quest has a button where user can click to query the reward of the quest. When the button is clicked, the component will emit an event with a promise <code>resolve</code>. The component consumer is expected to resolve the promise with the reward associated with the quest.</p>
<p>Below is an example how we use this web component in HTML (<code>index.html</code>). It passes three quests to the component. When the component asks for a quest reward, it returns a random number as the reward.</p>
<pre class="language-html" tabindex="0"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quest-board</span>
    <span class="token attr-name">quests</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>["Echoes of the Forgotten Realm", "The Ashen King<span class="token entity named-entity" title="&apos;">&amp;apos;</span>s Bargain", "The Clockwork Gambit"]<span class="token punctuation">'</span></span>
  <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>quest-board</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">const</span> questBoard <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'quest-board'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  questBoard<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'quest-clicked'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> resolve<span class="token punctuation">,</span> reject <span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">.</span>detail<span class="token punctuation">;</span>
    <span class="token keyword">const</span> randomReward <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>randomReward<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>
<p>We can try out this component by:</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token builtin class-name">cd</span> quest-board
<span class="token function">pnpm</span> <span class="token function">install</span>
<span class="token function">pnpm</span> run dev</code></pre>
<img align="center" width="350px" src="https://github.com/user-attachments/assets/e6a6342f-61fd-444a-82d3-d2547fa6bb63">
<p>Example interaction of the quest-board component.</p>
<h2 id="1-2-compile-the-component-to-a-js-file" tabindex="-1">1.2. Compile the Component to a JS File <a class="header-anchor" href="#1-2-compile-the-component-to-a-js-file">#</a></h2>
<p>We use Vite’s library mode to build the web component as a JS file. Consumers can import the JS file and use our component by writing HTML element <code>&lt;quest-board&gt;&lt;/quest-board&gt;</code>.</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token builtin class-name">cd</span> quest-board
<span class="token function">pnpm</span> <span class="token function">install</span>
<span class="token function">pnpm</span> run build:library</code></pre>
<pre class="language-json" tabindex="0"><code class="language-json"># package.json<span class="token operator">:</span> define the library entry point
<span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"."</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"import"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"types"</span><span class="token operator">:</span> <span class="token string">"./lib/quest-board.d.ts"</span><span class="token punctuation">,</span>
      <span class="token property">"default"</span><span class="token operator">:</span> <span class="token string">"./lib/index.js"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre>
<h1 id="2-integrate-web-component-into-streamlit" tabindex="-1">2. Integrate Web Component into Streamlit <a class="header-anchor" href="#2-integrate-web-component-into-streamlit">#</a></h1>
<p>Download the official Streamlit custom component template from <a href="https://github.com/streamlit/component-template">GitHub</a>. We will use the react-less template.</p>
<h2 id="2-1-import-compiled-web-component" tabindex="-1">2.1. Import Compiled Web Component <a class="header-anchor" href="#2-1-import-compiled-web-component">#</a></h2>
<p>We add an NPM dependency of our web component from the template’s frontend NPM package.</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token builtin class-name">cd</span> quest_board_stremlit/frontend
<span class="token function">pnpm</span> <span class="token function">add</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/quest_board
<span class="token function">pnpm</span> <span class="token function">install</span></code></pre>
<p>Then, in <code>frontend/index.tsx</code> , we will add code to create the <code>&lt;quest-board&gt;</code> element and bind data properties as well as event handlers.</p>
<pre class="language-tsx" tabindex="0"><code class="language-tsx"><span class="token keyword">import</span> <span class="token string">'quest-board'</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>questBoardContainer <span class="token operator">=</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>
  document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>questBoardContainer<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'quest-board-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>questBoardElement <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>questBoardContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>
  document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'quest-board'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="2-2-streamlit-component-development" tabindex="-1">2.2. Streamlit Component Development <a class="header-anchor" href="#2-2-streamlit-component-development">#</a></h2>
<p>Next, we willl create a Streamlit Component by building a wrapper that manages the data and events for our <code>quest-board</code> component. To view the Streamlit Component, we need to launch two servers:</p>
<p><strong>Frontend</strong></p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token builtin class-name">cd</span> quest_board_stremlit/quest_board_stremlit/frontend
<span class="token function">pnpm</span> <span class="token function">install</span>
<span class="token function">pnpm</span> run start</code></pre>
<p><strong>Backend</strong></p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token builtin class-name">cd</span> quest_board_streamlit
pip <span class="token function">install</span> <span class="token parameter variable">-e</span> <span class="token builtin class-name">.</span>
streamlit run quest_board_stremlit/example.py</code></pre>
<h1 id="3-design-data-and-event-flow" tabindex="-1">3. Design Data and Event Flow <a class="header-anchor" href="#3-design-data-and-event-flow">#</a></h1>
<p>The most complex aspect is managing the data and event flow. Unlike a traditional browser's event-driven flow, Streamlit uses a declarative approach, meaning changes only appear in the app after calling <code>st.rerun()</code>. We'll divide the data and event flow into two sections: (1) between the <strong>web component</strong> and the Streamlit <strong>wrapper frontend</strong>, and (2) between the Streamlit <strong>wrapper frontend</strong> and the <strong>backend</strong>.</p>
<img align="center" width="100%" src="https://github.com/user-attachments/assets/b5133265-28a1-4e6d-9d24-dbb4e9e362ec">
<h2 id="3-1-web-component-wrapper-frontend" tabindex="-1">3.1. Web Component ↔ Wrapper Frontend <a class="header-anchor" href="#3-1-web-component-wrapper-frontend">#</a></h2>
<h3 id="data" tabindex="-1"><strong>Data</strong> <a class="header-anchor" href="#data">#</a></h3>
<p>The wrapper frontend will pass the data to our web component through the typical HTML attributes or JavaScript component properties. This is implemented in <code>frontend/index.tsx</code>.</p>
<pre class="language-tsx" tabindex="0"><code class="language-tsx"><span class="token keyword">this</span><span class="token punctuation">.</span>questBoardElement<span class="token punctuation">.</span>quests <span class="token operator">=</span> data<span class="token punctuation">.</span>args<span class="token punctuation">.</span>quests<span class="token punctuation">;</span></code></pre>
<h3 id="event" tabindex="-1">Event <a class="header-anchor" href="#event">#</a></h3>
<p>The event flow is also similar to typical web apps. We declare event listeners to catch events coming from <code>&lt;quest-board&gt;</code> .</p>
<pre class="language-tsx" tabindex="0"><code class="language-tsx"><span class="token keyword">this</span><span class="token punctuation">.</span>questBoardElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'quest-clicked'</span><span class="token punctuation">,</span> event <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="3-2-wrapper-frontend-wrapper-backend" tabindex="-1">3.2. Wrapper Frontend ↔ Wrapper Backend <a class="header-anchor" href="#3-2-wrapper-frontend-wrapper-backend">#</a></h2>
<h3 id="data-1" tabindex="-1">Data <a class="header-anchor" href="#data-1">#</a></h3>
<p>The data flows between Streamlit Python backend and JavaScript frontend through props. We define the props in <code>__init__.py</code> , and the JavaScript can access passed props through the special <code>Streamlit.RENDER_EVNT</code> event.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># __init__.py</span>
<span class="token keyword">def</span> <span class="token function">quest_board</span><span class="token punctuation">(</span>
    quests<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">,</span> event_responses<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>QuestBoardResponse<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">dict</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">[</span>QuestBoardEvent<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">:</span></code></pre>
<pre class="language-tsx" tabindex="0"><code class="language-tsx"><span class="token comment">// frontend/index.tsx</span>
Streamlit<span class="token punctuation">.</span>events<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>Streamlit<span class="token punctuation">.</span><span class="token constant">RENDER_EVENT</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> Event<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  questBoardComponent<span class="token punctuation">.</span><span class="token function">onRender</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">onRender</span><span class="token punctuation">(</span>event<span class="token operator">:</span> Event<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get the RenderData from the event</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">(</span>event <span class="token keyword">as</span> CustomEvent<span class="token operator">&lt;</span>RenderData<span class="token operator">&lt;</span>EuphonyComponentProps<span class="token operator">>></span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>detail<span class="token punctuation">;</span>
  <span class="token keyword">const</span> questsString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>args<span class="token punctuation">.</span>quests<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="event-1" tabindex="-1">Event <a class="header-anchor" href="#event-1">#</a></h3>
<p>In Streamlit's wrapper backend, we can't create event listeners directly. Instead, we use the existing data communication channel to manage events. In Streamlit, a component can send a reactive value back to the backend, which we can use to include <strong>event requests</strong>. Once the backend processes these requests, we send the <strong>event responses</strong> back to the frontend using the same props.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token comment"># example.py</span>

<span class="token comment"># Create the component and its reactive component_value</span>
component_value <span class="token operator">=</span> quest_board<span class="token punctuation">(</span>quests<span class="token punctuation">,</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">"event_responses"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span>key<span class="token punctuation">)</span>

<span class="token comment"># "Event loop": continuously checking if there are new requests in component_value</span>
<span class="token comment"># If there are new requests, handle them, and use st.rerun() to send the response</span>
<span class="token comment"># back into the frontend</span>
<span class="token keyword">if</span> component_value <span class="token keyword">and</span> component_value<span class="token punctuation">[</span><span class="token string">"events"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token comment"># Clean the previous responses</span>
    st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">"event_responses"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    events_to_handle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> e <span class="token keyword">in</span> component_value<span class="token punctuation">[</span><span class="token string">"events"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> e<span class="token punctuation">[</span><span class="token string">"uniqueID"</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">"handled_events"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            events_to_handle<span class="token punctuation">.</span>append<span class="token punctuation">(</span>e<span class="token punctuation">)</span>

    <span class="token comment"># Handle the events</span>
    tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> e <span class="token keyword">in</span> events_to_handle<span class="token punctuation">:</span>
        tasks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>handle_event<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>events_to_handle<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>rerun<span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"fragment"</span><span class="token punctuation">)</span></code></pre>
<pre class="language-tsx" tabindex="0"><code class="language-tsx"><span class="token comment">// frontend/index.tsx</span>

<span class="token comment">// Helper function to send event requests to streamlit component value</span>
<span class="token function">_dispatchPendingEvent</span><span class="token punctuation">(</span>
  eventName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  detail<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  uniqueID<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token function-variable function">resolve</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token function-variable function">reject</span><span class="token operator">:</span> <span class="token punctuation">(</span>reason<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pendingEvents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    event<span class="token operator">:</span> eventName<span class="token punctuation">,</span>
    detail<span class="token operator">:</span> detail<span class="token punctuation">,</span>
    uniqueID
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>eventResolveMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>uniqueID<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    resolve<span class="token operator">:</span> resolve<span class="token punctuation">,</span>
    reject<span class="token operator">:</span> reject
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventDispatchTimer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventDispatchTimer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

	<span class="token comment">// There is a delay of Streamlit communication.</span>
	<span class="token comment">// We stagger and batch events to prevent some events being missed</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>eventDispatchTimer <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    Streamlit<span class="token punctuation">.</span><span class="token function">setComponentValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      events<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pendingEvents
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Delegate the event handling of quest-clicked to Python</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>questBoardElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'quest-clicked'</span><span class="token punctuation">,</span> event <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> customEvent <span class="token operator">=</span> event <span class="token keyword">as</span> CustomEvent<span class="token operator">&lt;</span>QuestClickedRequest<span class="token operator">></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> request <span class="token operator">=</span> customEvent<span class="token punctuation">.</span>detail<span class="token punctuation">;</span>
  <span class="token keyword">const</span> uniqueID <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_dispatchPendingEvent</span><span class="token punctuation">(</span>
    <span class="token string">'quest-clicked'</span><span class="token punctuation">,</span>
    request<span class="token punctuation">.</span>quest<span class="token punctuation">,</span>
    uniqueID<span class="token punctuation">,</span>
    request<span class="token punctuation">.</span>resolve<span class="token punctuation">,</span>
    request<span class="token punctuation">.</span>reject
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>After binding the data and events, we now have a working Streamlit component with two-way communication to our custom web component!</p>
<img align="center" width="500px" src="https://github.com/user-attachments/assets/42c71fcc-1cb2-40c0-80da-64c4c00c061c">
<p>Working example of our quest board web component as a streamlit custom component.</p>
<h1 id="4-use-streamlit-component-in-streamlit-app" tabindex="-1">4. Use Streamlit Component in Streamlit App <a class="header-anchor" href="#4-use-streamlit-component-in-streamlit-app">#</a></h1>
<p>Finally, we can distribute the component and use it in any Streamlit apps. To build a wheel and distribute the wheel, check out the <a href="https://docs.streamlit.io/develop/concepts/custom-components/publish">official guide</a>. To import this Streamlit component, follow the same pattern as in the <code>example.py</code>. Each app can implement its own logic to handle the events coming from the <code>quest-board</code> component.</p>


    <div class="splitter"></div>
    <span class="edit-button">
      <svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
        <path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"/>
      </svg>
    </span>

    <a href="https://github.com/xiaohk/notes/tree/main/content/note/streamlit-custom-component.md" class="filename">Edit this post</a>
  </div>
</div>

    <ul class="links-nextprev">
        <li>Previous:
            <a href="/add-acm-badge.html">Add ACM Badges to ACM Preprints</a>
        </li>
      
    </ul>
    </main>

    <footer></footer>

    <!-- Current page: /streamlit-custom-component.html -->
  </body>
</html>